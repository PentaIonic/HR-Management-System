
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'sidebar-bg': '#1E3A8A', // Dark Blue
                        'content-bg': '#F3F4F6', // Light Gray
                        'card-bg': '#FFFFFF',
                        'primary-button': '#10B981', // Green
                        'primary-button-hover': '#059669',
                        'secondary-button': '#6B7280',
                        'secondary-button-hover': '#4B5563',
                        'danger-text': '#EF4444',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for a cleaner look if needed */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .input-field {
            @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .label-text {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .summary-label {
            @apply text-sm text-gray-600;
        }
        .summary-value {
            @apply text-sm font-semibold text-gray-900;
        }
        .summary-value-emphasis {
            @apply text-lg font-bold text-gray-900;
        }
        .summary-value-deduction {
            @apply text-lg font-bold text-danger-text;
        }
    </style>
</head>
<body class="bg-content-bg font-sans">
    <div class="flex h-screen">
        <aside class="w-64 bg-sidebar-bg text-white flex flex-col p-4 space-y-6">
            <div class="text-2xl font-semibold">HR ADMIN</div>
            <div class="relative">
                <input type="search" placeholder="Search" class="w-full py-2 px-3 rounded-md bg-blue-900 text-white placeholder-gray-300 focus:outline-none">
                </div>
            <nav class="flex-grow">
                <ul>
                    <li class="mb-2"><a href="#" class="block py-2 px-3 rounded-md hover:bg-blue-700">General</a></li>
                    <li class="mb-2"><a href="#" class="block py-2 px-3 rounded-md hover:bg-blue-700">Employees</a></li>
                    <li class="mb-2"><a href="#" class="block py-2 px-3 rounded-md bg-blue-700 font-semibold">Payroll</a></li>
                    <li class="mb-2"><a href="#" class="block py-2 px-3 rounded-md hover:bg-blue-700">Jobs</a></li>
                    <li class="mb-2"><a href="#" class="block py-2 px-3 rounded-md hover:bg-blue-700">Calendar</a></li>
                </ul>
            </nav>
            </aside>

        <main class="flex-1 p-6 overflow-y-auto">
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">Payroll Management</h1>
                <div class="flex items-center space-x-4">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                    <div class="w-8 h-8 bg-primary-button rounded-full"></div> </div>
            </header>

            <section id="payrollOverview" class="bg-card-bg p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Payroll Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label for="filterEmployees" class="label-text">Filter Employees:</label>
                        <select id="filterEmployees" class="input-field">
                            <option>All Employees</option>
                            </select>
                    </div>
                    <div>
                        <label for="department" class="label-text">Department:</label>
                        <select id="department" class="input-field">
                            <option>All</option>
                            </select>
                    </div>
                    <div>
                        <label for="status" class="label-text">Status:</label>
                        <select id="status" class="input-field">
                            <option>All</option>
                            </select>
                    </div>
                    <div>
                        <label for="jobTitle" class="label-text">Job Title:</label>
                        <select id="jobTitle" class="input-field">
                            <option>All</option>
                            </select>
                    </div>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <label for="sortBy" class="label-text">Sort By:</label>
                        <select id="sortBy" class="input-field w-auto inline-block">
                            <option>Name (A-Z)</option>
                            </select>
                    </div>
                    <span class="text-sm text-gray-600">Displaying 0 of 0 Employees</span>
                </div>
                <button class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md">
                    Export Payroll Data
                </button>
                </section>

           <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <section id="employeePayrollDetails" class="lg:col-span-2 bg-card-bg p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold text-gray-700 mb-6">Employee Payroll Details</h2>
        <form id="payrollForm" class="space-y-4">
            <div>
                <label for="employeeName" class="label-text">Employee Name:</label>
                <input type="text" id="employeeName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="e.g., Juan Dela Cruz">
            </div>
            <div>
                <label for="employeeId" class="label-text">Employee ID:</label>
                <input type="text" id="employeeId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="e.g., EMP-001">
            </div>
            <div>
                <label for="basicSalary" class="label-text">Basic Salary (₱):</label>
                <div class="relative">
                    <input type="number" id="basicSalary" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="0.00">
                    <span class="absolute left-3 top-3 text-gray-500">₱</span>
                </div>
            </div>
            <div>
                <label for="workingDays" class="label-text">Payroll Period:</label>
                <select id="workingDays" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="Choose Period">
                    <option value="1 Month">1 Month</option>
                </select>
            </div>
            <div>
                <label for="daysWorked" class="label-text">Actual Days Worked:</label>
                <input type="number" id="daysWorked" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="e.g., 30">
            </div>
            <div>
                <label for="overtimeHours" class="label-text">Overtime Hours:</label>
                <input type="number" id="overtimeHours" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="0">
            </div>
            <div>
                <label for="allowances" class="label-text">Allowances (₱):</label>
                <div class="relative">
                    <input type="number" id="allowances" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="0.00">
                    <span class="absolute left-3 top-3 text-gray-500">₱</span>
                </div>
            </div>
            <div>
                <label for="otherDeductions" class="label-text">Other Deductions (e.g., Loans) (₱):</label>
                <div class="relative">
                    <input type="number" id="otherDeductions" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all placeholder-gray-400" placeholder="0.00">
                    <span class="absolute left-3 top-3 text-gray-500">₱</span>
                </div>
            </div>

            <div class="flex space-x-3 pt-4">
                <button type="button" id="resetButton" class="bg-secondary-button hover:bg-secondary-button-hover text-white font-medium py-2 px-4 rounded-md">Reset</button>
            </div>
        </form>
    </section>

                <section id="payrollSummary" class="bg-card-bg p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold text-gray-700 mb-6">Payroll Summary</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="summary-label">Basic Pay:</span>
                            <span id="summaryBasicPay" class="summary-value">₱0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="summary-label">Total Allowances:</span>
                            <span id="summaryTotalAllowances" class="summary-value">₱0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="summary-label">Overtime Pay:</span>
                            <span id="summaryOvertimePay" class="summary-value">₱0.00</span>
                        </div>
                        <hr class="my-2">
                        <div class="flex justify-between">
                            <span class="summary-label font-bold">Gross Pay:</span>
                            <span id="summaryGrossPay" class="summary-value-emphasis text-blue-800">₱0.00</span>
                        </div>
                        <hr class="my-2">
                        <div class="flex justify-between">
                            <span class="summary-label">Withholding Tax:</span>
                            <span id="summaryWithholdingTax" class="summary-value">₱0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="summary-label">SSS:</span>
                            <span id="summarySSS" class="summary-value">₱0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="summary-label">PhilHealth:</span>
                            <span id="summaryPhilHealth" class="summary-value">₱0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="summary-label">Pag-IBIG:</span>
                            <span id="summaryPagibig" class="summary-value">₱0.00</span>
                        </div>
                         <div class="flex justify-between">
                            <span class="summary-label">Other Deductions:</span>
                            <span id="summaryOtherDeductions" class="summary-value">₱0.00</span>
                        </div>
                        <hr class="my-2">
                        <div class="flex justify-between">
                            <span class="summary-label font-bold">Total Deductions:</span>
                            <span id="summaryTotalDeductions" class="summary-value-deduction text-red-800">-₱0.00</span>
                        </div>
                        <hr class="my-2 border-2 border-gray-300">
                        <div class="flex justify-between">
                            <span class="summary-label text-xl font-bold">Net Pay:</span>
                            <span id="summaryNetPay" class="summary-value-emphasis text-primary-button">₱0.00</span>
                        </div>
                    </div>
                    <div class="mt-8 flex flex-col space-y-3">
                        <button id="savePayrollButton" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md w-full">Save Payroll</button>
                        <button id="generatePayslipButton" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md w-full">Generate Payslip</button>
                    </div>
                </section>
            </div>
            
            <div id="messageArea" class="mt-6 p-4 rounded-md text-center hidden"></div>
        </main>
    </div>

<script type="module">
    // Firebase SDKs - Import only what you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, collection, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
    // If you need analytics, uncomment the line below and the corresponding initialization
    // import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAWwfUOhfq0gvli2ToaXHSwm6rTPSTBzMs",
        authDomain: "payrollsystem-ffa42.firebaseapp.com",
        projectId: "payrollsystem-ffa42",
        storageBucket: "payrollsystem-ffa42.firebasestorage.app",
        messagingSenderId: "386950136786",
        appId: "1:386950136786:web:03bb63947aed12edc93e0b",
        measurementId: "G-VQ5N2176MJ"
    };
    
    let app;
    let auth;
    let db;
    let currentUserId = null;

    const appIdFromHost = firebaseConfig.appId.split(':')[2] || 'default-payroll-app';

    if (firebaseConfig && firebaseConfig.projectId !== "YOUR_PROJECT_ID") { 
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            setLogLevel('debug');

            // If you want to use Firebase Analytics, uncomment the next two lines:
            // const analytics = getAnalytics(app);
            // console.log("Firebase Analytics initialized.");

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUserId = user.uid;
                    console.log("User is signed in with UID:", currentUserId);
                    showMessage(`Firebase ready. User: ${currentUserId.substring(0,8)}...`, "success");
                } else {
                    console.log("User is signed out. Attempting to sign in anonymously...");
                    try {
                        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                            console.log("Signed in with custom token.");
                        } else {
                            await signInAnonymously(auth);
                            console.log("Signed in anonymously.");
                        }
                    } catch (error) {
                        console.error("Error during sign-in:", error);
                        showMessage("Error: Could not sign in to Firebase. Saving will not work.", "error");
                    }
                }
            });
        } catch (e) {
            console.error("Error initializing Firebase:", e);
            showMessage("Error: Could not initialize Firebase. Saving will not work.", "error");
            db = null;
        }
    } else {
        console.warn("Firebase is not configured or using placeholder. 'Save Payroll' will be a mock.");
        showMessage("Firebase not configured. 'Save Payroll' is a mock.", "warning");
    }

    // DOM Elements
    const employeeNameEl = document.getElementById('employeeName');
    const employeeIdEl = document.getElementById('employeeId');
    const basicSalaryEl = document.getElementById('basicSalary');
    const workingDaysEl = document.getElementById('workingDays');
    const daysWorkedEl = document.getElementById('daysWorked');
    const overtimeHoursEl = document.getElementById('overtimeHours');
    const allowancesEl = document.getElementById('allowances');
    const otherDeductionsInputEl = document.getElementById('otherDeductions');

    const summaryBasicPayEl = document.getElementById('summaryBasicPay');
    const summaryTotalAllowancesEl = document.getElementById('summaryTotalAllowances');
    const summaryOvertimePayEl = document.getElementById('summaryOvertimePay');
    const summaryGrossPayEl = document.getElementById('summaryGrossPay');
    const summaryWithholdingTaxEl = document.getElementById('summaryWithholdingTax');
    const summarySSSEl = document.getElementById('summarySSS');
    const summaryPhilHealthEl = document.getElementById('summaryPhilHealth');
    const summaryPagibigEl = document.getElementById('summaryPagibig');
    const summaryOtherDeductionsEl = document.getElementById('summaryOtherDeductions');
    const summaryTotalDeductionsEl = document.getElementById('summaryTotalDeductions');
    const summaryNetPayEl = document.getElementById('summaryNetPay');

    const resetButton = document.getElementById('resetButton');
    const savePayrollButton = document.getElementById('savePayrollButton');
    const generatePayslipButton = document.getElementById('generatePayslipButton');
    const payrollForm = document.getElementById('payrollForm');
    const messageArea = document.getElementById('messageArea');

    // --- Helper Functions ---
    function formatCurrency(amount) {
        return `₱${parseFloat(amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}`;
    }

    function showMessage(message, type = "info") {
        messageArea.textContent = message;
        messageArea.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700', 'bg-yellow-100', 'text-yellow-700', 'bg-blue-100', 'text-blue-700');
        if (type === "success") {
            messageArea.classList.add('bg-green-100', 'text-green-700');
        } else if (type === "error") {
            messageArea.classList.add('bg-red-100', 'text-red-700');
        } else if (type === "warning") {
            messageArea.classList.add('bg-yellow-100', 'text-yellow-700');
        } else {
            messageArea.classList.add('bg-blue-100', 'text-blue-700');
        }
        messageArea.classList.remove('hidden');
        setTimeout(() => {
            if (messageArea.textContent === message) {
                messageArea.classList.add('hidden');
            }
        }, 5000);
    }

    // --- Calculation Logic ---
    const STANDARD_MONTHLY_WORKING_DAYS = 22;

    function calculateProratedBasicPay(monthlySalary, daysWorkedInPeriod, standardDaysInMonth) {
        if (!monthlySalary || !daysWorkedInPeriod || !standardDaysInMonth || standardDaysInMonth <= 0) return 0;
        return (monthlySalary / standardDaysInMonth) * daysWorkedInPeriod;
    }

    function calculateOvertimePay(basicSalary, overtimeHours) {
        if (!basicSalary || !overtimeHours) return 0;
        const dailyRate = basicSalary / STANDARD_MONTHLY_WORKING_DAYS;
        const hourlyRate = dailyRate / 8;
        const otPay = hourlyRate * 1.25 * overtimeHours;
        return otPay;
    }

    function calculateSSS(grossPay) {
        if (grossPay <= 0) return 0;
        let msc = 0;
        if (grossPay < 3250) msc = 3250;
        else if (grossPay >= 30000) msc = 30000;
        else msc = Math.ceil(grossPay / 500) * 500;
        return msc * 0.045;
    }

    function calculatePhilHealth(basicSalary) {
        if (basicSalary <= 0) return 0;
        let premiumBase = Math.max(10000, Math.min(basicSalary, 100000));
        return premiumBase * 0.025;
    }

    function calculatePagibig(basicSalary) {
        if (basicSalary <= 0) return 0;
        let rate = basicSalary < 1500 ? 0.01 : 0.02;
        let contribution = basicSalary * rate;
        return Math.min(contribution, 100);
    }

    function calculateWithholdingTax(grossPay, sss, philhealth, pagibig) {
        if (grossPay <= 0) return 0;
        const taxableIncome = grossPay - sss - philhealth - pagibig;
        if (taxableIncome <= 20833) {
            return 0;
        }
        let tax = 0;
        if (taxableIncome > 20833 && taxableIncome <= 33333) {
            tax = (taxableIncome - 20833) * 0.15;
        } else if (taxableIncome > 33333 && taxableIncome <= 66667) {
            tax = (20833 * 0) + ((33333-20833) * 0.15) + (taxableIncome - 33333) * 0.20;
        } else if (taxableIncome > 66667 && taxableIncome <= 166667) {
            tax = (20833 * 0) + ((33333-20833) * 0.15) + ((66667-33333) * 0.20) + (taxableIncome - 66667) * 0.25;
        }
        return Math.max(0, tax);
    }

    function performCalculations() {
        const basicSalary = parseFloat(basicSalaryEl.value) || 0;
        const actualDaysWorked = parseFloat(daysWorkedEl.value) || STANDARD_MONTHLY_WORKING_DAYS;
        const overtimeHours = parseFloat(overtimeHoursEl.value) || 0;
        const allowances = parseFloat(allowancesEl.value) || 0;
        const otherDeductions = parseFloat(otherDeductionsInputEl.value) || 0;

        const actualBasicPayForPeriod = calculateProratedBasicPay(basicSalary, actualDaysWorked, STANDARD_MONTHLY_WORKING_DAYS);
        const overtimePay = calculateOvertimePay(basicSalary, overtimeHours);
        const grossPay = actualBasicPayForPeriod + allowances + overtimePay;

        const sssContribution = calculateSSS(grossPay);
        const philHealthContribution = calculatePhilHealth(basicSalary);
        const pagibigContribution = calculatePagibig(basicSalary);
        const withholdingTax = calculateWithholdingTax(grossPay, sssContribution, philHealthContribution, pagibigContribution);

        const totalDeductions = sssContribution + philHealthContribution + pagibigContribution + withholdingTax + otherDeductions;
        const netPay = grossPay - totalDeductions;

        summaryBasicPayEl.textContent = formatCurrency(actualBasicPayForPeriod);
        summaryTotalAllowancesEl.textContent = formatCurrency(allowances);
        summaryOvertimePayEl.textContent = formatCurrency(overtimePay);
        summaryGrossPayEl.textContent = formatCurrency(grossPay);

        summaryWithholdingTaxEl.textContent = formatCurrency(withholdingTax);
        summarySSSEl.textContent = formatCurrency(sssContribution);
        summaryPhilHealthEl.textContent = formatCurrency(philHealthContribution);
        summaryPagibigEl.textContent = formatCurrency(pagibigContribution);
        summaryOtherDeductionsEl.textContent = formatCurrency(otherDeductions);
        summaryTotalDeductionsEl.textContent = formatCurrency(totalDeductions);
        summaryNetPayEl.textContent = formatCurrency(netPay);

        return {
            employeeName: employeeNameEl.value,
            employeeId: employeeIdEl.value,
            payrollPeriod: workingDaysEl.value,
            basicSalaryInput: basicSalary,
            daysWorked: actualDaysWorked,
            actualBasicPayForPeriod: actualBasicPayForPeriod,
            overtimeHours: overtimeHours,
            overtimePay: overtimePay,
            allowances: allowances,
            grossPay: grossPay,
            sssContribution: sssContribution,
            philHealthContribution: philHealthContribution,
            pagibigContribution: pagibigContribution,
            withholdingTax: withholdingTax,
            otherDeductions: otherDeductions,
            totalDeductions: totalDeductions,
            netPay: netPay,
            calculatedAt: serverTimestamp()
        };
    }

    // --- Event Listeners ---

    // Auto-calculate on input changes for a dynamic experience
    [employeeNameEl, employeeIdEl, basicSalaryEl, daysWorkedEl, overtimeHoursEl, allowancesEl, otherDeductionsInputEl].forEach(el => {
        el.addEventListener('input', () => {
            performCalculations();
        });
    });

    resetButton.addEventListener('click', () => {
        payrollForm.reset();
        performCalculations();
        showMessage("Form reset.", "info");
    });

    savePayrollButton.addEventListener('click', async () => {
        if (!db || !currentUserId) {
            showMessage("Firebase not ready or user not signed in. Cannot save payroll.", "error");
            console.error("Firestore instance (db) or currentUserId is not available.");
            return;
        }

        const payrollData = performCalculations();
        if (!payrollData.employeeId || !payrollData.employeeName) {
            showMessage("Employee Name and ID are required to save.", "warning");
            return;
        }

        const docId = `${payrollData.employeeId}_${payrollData.payrollPeriod.replace(/\s+/g, '-')}_${Date.now()}`;
        const payrollDocRef = doc(db, "artifacts", appIdFromHost, "public/data/payrolls", docId);

        try {
            await setDoc(payrollDocRef, payrollData);
            showMessage(`Payroll for ${payrollData.employeeName} saved successfully! ID: ${docId.substring(0,15)}...`, "success");
            console.log("Payroll data saved with ID:", docId);
        } catch (error) {
            console.error("Error saving payroll data: ", error);
            showMessage("Error saving payroll data. Check console for details.", "error");
        }
    });

    generatePayslipButton.addEventListener('click', () => {
        const payrollData = performCalculations();
        console.log("--- GENERATE PAYSILP (DATA) ---");
        console.log(payrollData);
        showMessage(`Payslip data for ${payrollData.employeeName} logged to console. (This is a mock)`, "info");
        alert(`Mock Payslip for: ${payrollData.employeeName}\nNet Pay: ${formatCurrency(payrollData.netPay)}\n(Full details in console)`);
    });

    // Initial calculation to set ₱0.00 format correctly
    performCalculations();
</script>
</body>
</html>